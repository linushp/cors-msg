!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.corsMsg2=e():t.corsMsg2=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){var r=n(1);t.exports=r},function(t,e,n){function r(t,e,n){return n?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}function i(t,e,n){if(n)return e?e(t()):t();try{var r=Promise.resolve(t());return e?r.then(e):r}catch(t){return Promise.reject(t)}}function o(){}function s(t){var e=t();if(e&&e.then)return e.then(o)}function u(t,e){try{var n=t()}catch(t){return e(t)}return n&&n.then?n.then(void 0,e):n}function c(t,e){return t&&t.then?t.then(e):e(t)}function f(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return Promise.resolve(t.apply(this,e))}catch(t){return Promise.reject(t)}}}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=n(2),p=function t(){var e=this,n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,"uniqueId",(function(t){return t+""+location.host+"_"+Date.now()+"_"+n.uniqueIndex++})),a(this,"handleMessage",(function(t){var e=t.data||{},r=e.scriptName,i=e.scriptId,o=e.scriptFrom;if(r&&i&&o&&("cors-msg-req"===o&&n.bus.emit(r,e,t),"cors-msg-res"===o)){var s="res_"+i;n.bus.emit(s,e,t)}})),a(this,"acceptCorsScript",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*";n.bus.off(t),n.bus.on(t,f((function(t,n){var f=t.scriptName,a=t.scriptId,l=t.scriptString,p=null,d=null;return c(u((function(){return s((function(){return e?r(e({scriptName:f,scriptId:a,scriptString:l,evt:n}),(function(t){d=t})):i(new Function(l),(function(t){d=t}))}))}),(function(t){console.log("onScript",t),p={name:t.name,stack:t.stack,str:t.toString()}})),(function(){window.postMessage({scriptName:f,scriptId:a,scriptString:l,scriptFrom:"cors-msg-res",scriptResult:d,scriptError:p},o)}))})))})),a(this,"rejectCorsScript",(function(t){n.bus.off(t)})),a(this,"sendCorsScript",f((function(t){var n=t.scriptName,r=t.scriptString,i=t.targetOrigin,o=void 0===i?"*":i,s=t.timeout,u=void 0===s?1e4:s;return new Promise((function(t,i){var s=e.uniqueId(n),c="res_"+s,f=setTimeout((function(){e.bus.off(c),i({name:"timeout"})}),u);e.bus.on(c,(function(n,r){var o=n.scriptResult,s=n.scriptError;e.bus.off(c),clearTimeout(f),s?i(s):t(o)})),window.postMessage({scriptName:n,scriptId:s,scriptString:r,scriptFrom:"cors-msg-req"},o)}))}))),this.uniqueIndex=1,this.bus=new l,window.addEventListener("message",this.handleMessage)};var d=(window.corsMsg||(window.corsMsg=new p),window.corsMsg);t.exports=d},function(t,e){function n(t,e){this.name=t,this.listenerWrapper=e,this.$$listeners$$=[]}var r=n.prototype;r.on=function(t,e){this.$$listeners$$.push({eventName:t,listener:e})},r.setOn=function(t,e){for(var n=this.$$listeners$$,r=0;r<n.length;r++){var i=n[r];if(i.eventName===t)return void(i.listener=e)}this.on(t,e)},r.off=function(t,e){for(var n=this.$$listeners$$,r=[],i=0;i<n.length;i++){var o=n[i];e?o.eventName===t&&o.listener===e||r.push(o):o.eventName===t||r.push(o)}this.$$listeners$$=r},r.emit=function(t,e,n,r,i,o){for(var s=this.$$listeners$$,u=this.listenerWrapper,c=0;c<s.length;c++){var f=s[c];f.eventName===t&&f.listener&&(u?u(f.listener,e,n,r,i,o):f.listener(e,n,r,i,o))}},r.clearAllListeners=function(){this.$$listeners$$=[]},t.exports=n}])}));